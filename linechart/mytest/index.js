$.get('http://192.168.1.116:5020/dailyprices/A', function (resp) {
    let data = resp['A dailyprices'].DailyPrices;
    console.log(data.length);

    let dataPool = chunkArray(data, 1000);
    let poolPosition = 0;
    let iterator;
    let groups = [];

    let margin = {
      top: 20,
      right: 20,
      bottom: 30,
      left: 40
    };

    let width = 960 - margin.left - margin.right;
    let height = 500 - margin.top - margin.bottom;
    let padding = 100;

    let parseTime = d3.timeParse("%Y-%m-%d");
    let formatTime = d3.timeFormat('%Y %m %d');

    let x = d3.scaleTime()
        //.rangeRound([0, width])
        .range([padding , width - padding ])
        .domain(d3.extent(data, function(d) { return parseTime(d.d); }));

    let y = d3.scaleLinear()
        .range([height - padding , padding ])
        //.domain([0, d3.max(data, function(d) { return d.h; })]);
        .domain(d3.extent(data, function(d) { return d.h; }));

    let xAxis = d3.axisBottom()
        .scale(x);

    let yAxis = d3.axisLeft()
        .scale(y);

    let line = d3.line()
        .curve(d3.curveBasis)
        //.curve(d3.curveLinear)
        //.curve(d3.curveNatural)
        .x(function(d) { return x(parseTime(d.d)); })
        .y(function(d) { return y(d.h); });

    let chart = d3.select('.chart')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
      .append('g')
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');


    chart.append('g')
        .attr('class', 'x axis')
        .attr('transform', 'translate(0,' + (height - padding) + ')')
        .call(xAxis)
    // .append('text')
    //     .attr('text-anchor', 'middle')
    //     .attr('y', 6)
    //     .attr('dy', '.71em')
    //     .attr('transform', 'translate(' + width/2 + ',' + height + ')')
    //     .text('Dates');

    chart.append('g')
        .attr('class', 'y axis')
        .attr('transform', 'translate(' + padding + ',0)')
        .call(yAxis)
    //   .append('text')
    //     .attr('transform', 'translate(0,' + height/2 + ')rotate(-90)')
    //     .attr('y', 6)
    //     .attr('dy', '.71em')
    //     .style('text-anchor', 'middle')
    //     .text('High Prices')
    //     .attr('class', 'text-anchor');

    chart.selectAll('.xaxis text')
        .attr('transform', function(d) {
            return 'translate(' + this.getBBox().height * -2 + ',' + this.getBBox().height + ')rotate(-45)';
        });

    chart.append('text')
        .attr('text-anchor', 'middle')
        .attr('transform', 'translate(50,' + height/2 + ')rotate(-90)')
        .text('High Prices');

    chart.append('text')
        .attr('text-anchor', 'middle')
        .attr('transform', 'translate(' + width/2 + ',' + (height - (padding/2)) + ')')
        .text('Year');

    // chart.append('path')
    //     .datum(dataPool[poolPosition])
    //     .attr('class', 'line')
    //     .attr('d', line)
    //     .style('stroke', 'blue');

  updateViz();
  iterator = setInterval(updateViz, 100);

  function updateViz() {
    console.log(dataPool[poolPosition].length);

    // let stock = chart.selectAll('.stock')
    //   .data(dataPool[poolPosition])
    //   .enter().append('g')
    //     .attr('class', 'stock')

    // .append('path')
    //     .datum(dataPool[poolPosition])
    //     .attr('class', 'line')
    //     .attr('d', function(d) { return line(d); })
    //     .style('stroke', 'blue');
    chart.append('path')
        .datum(dataPool[poolPosition])
        .attr('class', 'line')
        .attr('d', line)
        .style('stroke', 'blue');
    
    console.log(poolPosition);
    poolPosition += 1;

    if (poolPosition >= dataPool.length) {
      clearInterval(iterator);
    }
  }
});

function chunkArray(ar,chunksize) {
    var R = [];
    if (chunksize <= 0) return ar;
    for (var i = 0; i < ar.length; i+=chunksize) {
        R.push(ar.slice(i,i+chunksize));
    }
    return R;
}

// let dat = [
//   {
//         "c": 44.0,
//         "d": "1999-11-18",
//         "h": 50.0,
//         "l": 40.0,
//         "o": 45.5,
//         "v": 44739900.0
//       },
//       {
//         "c": 40.38,
//         "d": "1999-11-19",
//         "h": 43.0,
//         "l": 39.81,
//         "o": 42.94,
//         "v": 10897100.0
//       },
//       {
//         "c": 44.0,
//         "d": "1999-11-22",
//         "h": 44.0,
//         "l": 40.06,
//         "o": 41.31,
//         "v": 4705200.0
//       },
//       {
//         "c": 40.25,
//         "d": "1999-11-23",
//         "h": 43.63,
//         "l": 40.25,
//         "o": 42.5,
//         "v": 4274400.0
//       },
//       {
//         "c": 41.06,
//         "d": "1999-11-24",
//         "h": 41.94,
//         "l": 40.0,
//         "o": 40.13,
//         "v": 3464400.0
//       },
//       {
//         "c": 41.19,
//         "d": "1999-11-26",
//         "h": 41.5,
//         "l": 40.75,
//         "o": 40.88,
//         "v": 1237100.0
//       },
//       {
//         "c": 42.13,
//         "d": "1999-11-29",
//         "h": 42.44,
//         "l": 40.56,
//         "o": 41.0,
//         "v": 2914700.0
//       },
//       {
//         "c": 42.19,
//         "d": "1999-11-30",
//         "h": 42.94,
//         "l": 40.94,
//         "o": 42.0,
//         "v": 3083000.0
//       },
//       {
//         "c": 42.94,
//         "d": "1999-12-01",
//         "h": 43.44,
//         "l": 41.88,
//         "o": 42.19,
//         "v": 2115400.0
//       },
//       {
//         "c": 44.13,
//         "d": "1999-12-02",
//         "h": 45.0,
//         "l": 43.19,
//         "o": 43.75,
//         "v": 2195900.0
//       },
//       {
//         "c": 44.5,
//         "d": "1999-12-03",
//         "h": 45.69,
//         "l": 44.31,
//         "o": 44.94,
//         "v": 2175700.0
//       },
//       {
//         "c": 45.75,
//         "d": "1999-12-06",
//         "h": 46.44,
//         "l": 45.19,
//         "o": 45.25,
//         "v": 1610000.0
//       },
//       {
//         "c": 45.25,
//         "d": "1999-12-07",
//         "h": 46.0,
//         "l": 44.31,
//         "o": 45.75,
//         "v": 1585100.0
//       },
//       {
//         "c": 45.19,
//         "d": "1999-12-08",
//         "h": 45.63,
//         "l": 44.81,
//         "o": 45.25,
//         "v": 1350400.0
//       },
//       {
//         "c": 45.81,
//         "d": "1999-12-09",
//         "h": 45.94,
//         "l": 45.25,
//         "o": 45.25,
//         "v": 1451400.0
//       },
//       {
//         "c": 44.75,
//         "d": "1999-12-10",
//         "h": 45.94,
//         "l": 44.75,
//         "o": 45.69,
//         "v": 1190800.0
//       },
//       {
//         "c": 45.5,
//         "d": "1999-12-13",
//         "h": 46.25,
//         "l": 44.38,
//         "o": 45.5,
//         "v": 2875900.0
//       },
//       {
//         "c": 43.0,
//         "d": "1999-12-14",
//         "h": 45.38,
//         "l": 42.06,
//         "o": 45.38,
//         "v": 1665900.0
//       },
//       {
//         "c": 41.69,
//         "d": "1999-12-15",
//         "h": 42.31,
//         "l": 41.0,
//         "o": 42.0,
//         "v": 2087100.0
//       },
//       {
//         "c": 47.25,
//         "d": "1999-12-16",
//         "h": 48.0,
//         "l": 42.0,
//         "o": 42.0,
//         "v": 1848300.0
//       },
//       {
//         "c": 45.94,
//         "d": "1999-12-17",
//         "h": 47.12,
//         "l": 45.44,
//         "o": 46.38,
//         "v": 2652400.0
//       },
//       {
//         "c": 46.88,
//         "d": "1999-12-20",
//         "h": 46.94,
//         "l": 46.13,
//         "o": 46.25,
//         "v": 856100.0
//       },
//       {
//         "c": 46.63,
//         "d": "1999-12-21",
//         "h": 46.69,
//         "l": 46.0,
//         "o": 46.69,
//         "v": 1616200.0
//       },
//       {
//         "c": 47.56,
//         "d": "1999-12-22",
//         "h": 47.56,
//         "l": 46.31,
//         "o": 46.63,
//         "v": 1363200.0
//       },
//       {
//         "c": 49.75,
//         "d": "1999-12-23",
//         "h": 50.0,
//         "l": 47.44,
//         "o": 47.5,
//         "v": 1544700.0
//       },
//       {
//         "c": 52.81,
//         "d": "1999-12-27",
//         "h": 53.19,
//         "l": 49.56,
//         "o": 49.94,
//         "v": 1451800.0
//       },
//       {
//         "c": 61.5,
//         "d": "1999-12-28",
//         "h": 61.5,
//         "l": 53.94,
//         "o": 54.25,
//         "v": 2546500.0
//       },
//       {
//         "c": 72.0,
//         "d": "1999-12-29",
//         "h": 79.06,
//         "l": 62.94,
//         "o": 63.0,
//         "v": 7524000.0
//       },
//       {
//         "c": 79.25,
//         "d": "1999-12-30",
//         "h": 80.0,
//         "l": 74.25,
//         "o": 76.0,
//         "v": 4771900.0
//       },
//       {
//         "c": 77.31,
//         "d": "1999-12-31",
//         "h": 79.94,
//         "l": 76.25,
//         "o": 79.5,
//         "v": 1381400.0
//       },
//       {
//         "c": 72.0,
//         "d": "2000-01-03",
//         "h": 78.94,
//         "l": 67.38,
//         "o": 78.75,
//         "v": 3343600.0
//       },
//       {
//         "c": 66.5,
//         "d": "2000-01-04",
//         "h": 68.88,
//         "l": 64.75,
//         "o": 68.13,
//         "v": 3408500.0
//       },
//       {
//         "c": 61.56,
//         "d": "2000-01-05",
//         "h": 66.31,
//         "l": 61.31,
//         "o": 66.25,
//         "v": 4119200.0
//       },
//       {
//         "c": 60.0,
//         "d": "2000-01-06",
//         "h": 62.0,
//         "l": 58.13,
//         "o": 61.63,
//         "v": 1812900.0
//       },
//       {
//         "c": 65.0,
//         "d": "2000-01-07",
//         "h": 65.94,
//         "l": 59.0,
//         "o": 59.06,
//         "v": 2016900.0
//       },
//       {
//         "c": 68.94,
//         "d": "2000-01-10",
//         "h": 69.63,
//         "l": 67.56,
//         "o": 69.0,
//         "v": 1536800.0
//       },
//       {
//         "c": 68.0,
//         "d": "2000-01-11",
//         "h": 68.94,
//         "l": 66.44,
//         "o": 68.94,
//         "v": 1327600.0
//       },
//       {
//         "c": 66.63,
//         "d": "2000-01-12",
//         "h": 68.0,
//         "l": 64.06,
//         "o": 68.0,
//         "v": 1022800.0
//       },
//       {
//         "c": 67.63,
//         "d": "2000-01-13",
//         "h": 69.81,
//         "l": 66.0,
//         "o": 68.38,
//         "v": 811400.0
//       },
//       {
//         "c": 68.38,
//         "d": "2000-01-14",
//         "h": 69.38,
//         "l": 67.0,
//         "o": 67.0,
//         "v": 942000.0
//       },
//       {
//         "c": 71.5,
//         "d": "2000-01-18",
//         "h": 72.88,
//         "l": 68.13,
//         "o": 68.63,
//         "v": 1503400.0
//       },
//       {
//         "c": 70.0,
//         "d": "2000-01-19",
//         "h": 72.0,
//         "l": 69.81,
//         "o": 72.0,
//         "v": 1877600.0
//       },
//       {
//         "c": 68.13,
//         "d": "2000-01-20",
//         "h": 70.88,
//         "l": 67.5,
//         "o": 70.75,
//         "v": 1436300.0
//       },
//       {
//         "c": 68.75,
//         "d": "2000-01-21",
//         "h": 69.38,
//         "l": 66.44,
//         "o": 69.13,
//         "v": 1372200.0
//       },
//       {
//         "c": 68.5,
//         "d": "2000-01-24",
//         "h": 71.81,
//         "l": 68.0,
//         "o": 68.5,
//         "v": 1499200.0
//       },
//       {
//         "c": 67.69,
//         "d": "2000-01-25",
//         "h": 69.63,
//         "l": 66.44,
//         "o": 68.75,
//         "v": 825300.0
//       },
//       {
//         "c": 68.31,
//         "d": "2000-01-26",
//         "h": 69.25,
//         "l": 67.88,
//         "o": 67.94,
//         "v": 731300.0
//       },
//       {
//         "c": 68.44,
//         "d": "2000-01-27",
//         "h": 70.5,
//         "l": 67.25,
//         "o": 69.88,
//         "v": 621300.0
//       },
//       {
//         "c": 68.06,
//         "d": "2000-01-28",
//         "h": 69.5,
//         "l": 67.44,
//         "o": 69.5,
//         "v": 1151100.0
//       },
//       {
//         "c": 66.19,
//         "d": "2000-01-31",
//         "h": 67.63,
//         "l": 64.75,
//         "o": 67.56,
//         "v": 744200.0
//       },
//       {
//         "c": 71.0,
//         "d": "2000-02-01",
//         "h": 72.0,
//         "l": 66.25,
//         "o": 66.25,
//         "v": 1004500.0
//       },
//       {
//         "c": 76.5,
//         "d": "2000-02-02",
//         "h": 76.5,
//         "l": 71.56,
//         "o": 71.88,
//         "v": 1391400.0
//       },
//       {
//         "c": 77.75,
//         "d": "2000-02-03",
//         "h": 77.75,
//         "l": 73.81,
//         "o": 75.19,
//         "v": 1272900.0
//       },
//       {
//         "c": 76.25,
//         "d": "2000-02-04",
//         "h": 77.75,
//         "l": 75.0,
//         "o": 77.75,
//         "v": 819500.0
//       },
//       {
//         "c": 79.5,
//         "d": "2000-02-07",
//         "h": 80.0,
//         "l": 76.25,
//         "o": 77.69,
//         "v": 911500.0
//       },
//       {
//         "c": 79.0,
//         "d": "2000-02-08",
//         "h": 82.19,
//         "l": 78.25,
//         "o": 80.75,
//         "v": 836700.0
//       }
// ];

